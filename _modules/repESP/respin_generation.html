

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>repESP.respin_generation &mdash; repESP 0.2.0-dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> repESP
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../repESP_intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../repESP_tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../repESP_usage.html">Usage notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../repESP_modules.html">Modules</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">repESP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>repESP.respin_generation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for repESP.respin_generation</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Creating ``resp`` program input for predefined ESP fitting types</span>

<span class="sd">This module may be useful if you require custom instructions for the ``resp``</span>
<span class="sd">program. Otherwise, the functions in the `resp_wrapper` module should be</span>
<span class="sd">sufficient and more convenient.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">repESP.charges</span> <span class="kn">import</span> <span class="n">Charge</span>
<span class="kn">from</span> <span class="nn">repESP.equivalence</span> <span class="kn">import</span> <span class="n">Equivalence</span>
<span class="kn">from</span> <span class="nn">repESP.respin_format</span> <span class="kn">import</span> <span class="n">Respin</span>
<span class="kn">from</span> <span class="nn">repESP.types</span> <span class="kn">import</span> <span class="n">Atom</span><span class="p">,</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">repESP._util</span> <span class="kn">import</span> <span class="n">zip_exact</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">TypeVar</span>


<div class="viewcode-block" id="RespinGenerator"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespinGenerator">[docs]</a><span class="k">class</span> <span class="nc">RespinGenerator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Interface for creators of ``resp`` fitting instructions</span>

<span class="sd">    This interface will be implemented differently for different types of</span>
<span class="sd">    fitting with the ``resp`` program. This module provides implementations</span>
<span class="sd">    for the most common fitting types.</span>

<span class="sd">    An implementation of this interface is required by the `prepare_respin`</span>
<span class="sd">    function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RespinGenerator.resp_type"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespinGenerator.resp_type">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">resp_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the human-readable description of the type of fitting&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="RespinGenerator.get_ivary"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespinGenerator.get_ivary">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_ivary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create the &quot;ivary&quot; section of the &quot;respin&quot; file&quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="RespinGenerator.get_cntrl"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespinGenerator.get_cntrl">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create the &quot;cntrl&quot; section of the &quot;respin&quot; file&quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<span class="n">RespRespinGeneratorT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;RespRespinGeneratorT&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;RespRespinGenerator&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="RespRespinGenerator"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespRespinGenerator">[docs]</a><span class="k">class</span> <span class="nc">RespRespinGenerator</span><span class="p">(</span><span class="n">RespinGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class providing &quot;respin&quot; creation methods for RESP charges&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ivary</span><span class="p">:</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ivary</span> <span class="o">=</span> <span class="n">ivary</span>

<div class="viewcode-block" id="RespRespinGenerator.get_ivary"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespRespinGenerator.get_ivary">[docs]</a>    <span class="k">def</span> <span class="nf">get_ivary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ivary</span></div>

<div class="viewcode-block" id="RespRespinGenerator.from_respin"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespRespinGenerator.from_respin">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_respin</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">RespRespinGeneratorT</span><span class="p">],</span> <span class="n">respin</span><span class="p">:</span> <span class="n">Respin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RespRespinGeneratorT</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Alternative initialization from a &quot;respin&quot; file</span>

<span class="sd">        This alternative initializer expresses the fact that this object can</span>
<span class="sd">        be created directly from an existing &quot;respin&quot; file, when the contained</span>
<span class="sd">        &quot;ivary&quot; section expresses the desired per-atom fitting instructions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        respin : Respin</span>
<span class="sd">            An object representing pre-existing instructions to the ``resp`` program.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">respin</span><span class="o">.</span><span class="n">ivary</span><span class="p">)</span></div>

<div class="viewcode-block" id="RespRespinGenerator.from_methyl_and_methylene"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespRespinGenerator.from_methyl_and_methylene">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">from_methyl_and_methylene</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">RespRespinGeneratorT</span><span class="p">],</span>
        <span class="n">equivalence</span><span class="p">:</span> <span class="n">Equivalence</span><span class="p">,</span>
        <span class="n">methyl_methylene_mask</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RespRespinGeneratorT</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Alternative initialization from chemical information</span>

<span class="sd">        The per-atom fitting instructions in the RESP charge optimization depend</span>
<span class="sd">        on the chemical equivalence and whether a given carbon or hydrogen atom</span>
<span class="sd">        belongs to a methyl or methylene group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        equivalence : Equivalence</span>
<span class="sd">            The chemical equivalence relations between atoms in the molecule.</span>
<span class="sd">        methyl_methylene_mask : typing.List[bool]</span>
<span class="sd">            A list, in which each value describes an atom of the molecule. The</span>
<span class="sd">            value should be True when the atom is a carbon or hydrogen atom in</span>
<span class="sd">            a methyl or methylene group and False otherwise.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            Raised when the length of the `values` attribute of the</span>
<span class="sd">            `equivalence` argument is not equal to the length of the</span>
<span class="sd">            `methyl_methylene_mask` argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<span class="n">RespStage1RespinGeneratorT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;RespStage1RespinGeneratorT&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;RespStage1RespinGenerator&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="RespStage1RespinGenerator"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespStage1RespinGenerator">[docs]</a><span class="k">class</span> <span class="nc">RespStage1RespinGenerator</span><span class="p">(</span><span class="n">RespRespinGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creator of &quot;respin&quot; files for 1st stage RESP fitting</span>

<span class="sd">    The original RESP procedure is conducted in two stages and this object</span>
<span class="sd">    prepares the input for the first stage. In this stage, carbon and hydrogen</span>
<span class="sd">    atoms in methyl and methylene groups vary freely, while other atoms need to</span>
<span class="sd">    obey chemical equivalence relations. The magnitudes of charges on all atoms</span>
<span class="sd">    are constrained with hyperbolic constraints with a weight factor of 0.0005.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ivary : Respin.Ivary</span>
<span class="sd">        The &quot;ivary&quot; section of a &quot;respin&quot; file for 1st stage RESP fitting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RespStage1RespinGenerator.resp_type"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespStage1RespinGenerator.resp_type">[docs]</a>    <span class="k">def</span> <span class="nf">resp_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;RESP stage 1&quot;</span></div>

<div class="viewcode-block" id="RespStage1RespinGenerator.get_cntrl"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespStage1RespinGenerator.get_cntrl">[docs]</a>    <span class="k">def</span> <span class="nf">get_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">(</span>
            <span class="n">qwt</span><span class="o">=</span><span class="mf">0.0005</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="RespStage1RespinGenerator.from_methyl_and_methylene"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespStage1RespinGenerator.from_methyl_and_methylene">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_methyl_and_methylene</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">RespStage1RespinGeneratorT</span><span class="p">],</span>
        <span class="n">equivalence</span><span class="p">:</span> <span class="n">Equivalence</span><span class="p">,</span>
        <span class="n">methyl_methylene_mask</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RespStage1RespinGeneratorT</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;See documentation in base class (`RespRespinGenerator`)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">([</span>
            <span class="mi">0</span> <span class="k">if</span> <span class="n">is_methyl_or_methylene</span> <span class="k">else</span> <span class="n">ivary_from_equivalence_value</span>
            <span class="k">for</span> <span class="n">ivary_from_equivalence_value</span><span class="p">,</span> <span class="n">is_methyl_or_methylene</span>
            <span class="ow">in</span> <span class="n">zip_exact</span><span class="p">(</span>
                <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="o">.</span><span class="n">from_equivalence</span><span class="p">(</span><span class="n">equivalence</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">methyl_methylene_mask</span>
            <span class="p">)</span>
        <span class="p">]))</span></div></div>


<span class="n">RespStage2RespinGeneratorT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;RespStage2RespinGeneratorT&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;RespStage2RespinGenerator&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="RespStage2RespinGenerator"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespStage2RespinGenerator">[docs]</a><span class="k">class</span> <span class="nc">RespStage2RespinGenerator</span><span class="p">(</span><span class="n">RespRespinGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creator of &quot;respin&quot; files for 2nd stage RESP fitting</span>

<span class="sd">    The original RESP procedure is conducted in two stages and this object</span>
<span class="sd">    prepares the input for the second stage. In this stage, carbon and hydrogen</span>
<span class="sd">    atoms in methyl and methylene groups are varied subject to equivalence</span>
<span class="sd">    relations and the magnitudes of the charges are constrained with hyperbolic</span>
<span class="sd">    constraints with a weight factor of 0.001. Other atoms are frozen at</span>
<span class="sd">    initial charge values, which should come from 1st stage fitting.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ivary : Respin.Ivary</span>
<span class="sd">        The &quot;ivary&quot; section of a &quot;respin&quot; file for 2nd stage RESP fitting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="RespStage2RespinGenerator.resp_type"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespStage2RespinGenerator.resp_type">[docs]</a>    <span class="k">def</span> <span class="nf">resp_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;RESP stage 2&quot;</span></div>

<div class="viewcode-block" id="RespStage2RespinGenerator.get_cntrl"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespStage2RespinGenerator.get_cntrl">[docs]</a>    <span class="k">def</span> <span class="nf">get_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">(</span>
            <span class="n">iqopt</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">qwt</span><span class="o">=</span><span class="mf">0.001</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="RespStage2RespinGenerator.from_methyl_and_methylene"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.RespStage2RespinGenerator.from_methyl_and_methylene">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_methyl_and_methylene</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">RespStage2RespinGeneratorT</span><span class="p">],</span>
        <span class="n">equivalence</span><span class="p">:</span> <span class="n">Equivalence</span><span class="p">,</span>
        <span class="n">methyl_methylene_mask</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RespStage2RespinGeneratorT</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;See documentation in base class (`RespRespinGenerator`)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">([</span>
            <span class="n">ivary_from_equivalence_value</span> <span class="k">if</span> <span class="n">is_methyl_or_methylene</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">ivary_from_equivalence_value</span><span class="p">,</span> <span class="n">is_methyl_or_methylene</span>
            <span class="ow">in</span> <span class="n">zip_exact</span><span class="p">(</span>
                <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="o">.</span><span class="n">from_equivalence</span><span class="p">(</span><span class="n">equivalence</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">methyl_methylene_mask</span>
            <span class="p">)</span>
        <span class="p">]))</span></div></div>


<div class="viewcode-block" id="FitHydrogensOnlyRespinGenerator"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.FitHydrogensOnlyRespinGenerator">[docs]</a><span class="k">class</span> <span class="nc">FitHydrogensOnlyRespinGenerator</span><span class="p">(</span><span class="n">RespinGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Supports creation of &quot;respin&quot; files for fitting only hydrogen atoms</span>

<span class="sd">    The generated &quot;respin&quot; file instructs ``resp`` to perform fitting in which</span>
<span class="sd">    only hydrogen atoms are free to vary, subject to equivalence relations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    equivalence : Equivalence</span>
<span class="sd">        The equivalence relations between atoms of the molecule.</span>
<span class="sd">    molecule : Molecule[Atom]</span>
<span class="sd">        The molecule which charges are being fitted. Only atom identities are required.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">equivalence</span><span class="p">:</span> <span class="n">Equivalence</span><span class="p">,</span> <span class="n">molecule</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">[</span><span class="n">Atom</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equivalence</span> <span class="o">=</span> <span class="n">equivalence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span> <span class="o">=</span> <span class="n">molecule</span>

<div class="viewcode-block" id="FitHydrogensOnlyRespinGenerator.resp_type"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.FitHydrogensOnlyRespinGenerator.resp_type">[docs]</a>    <span class="k">def</span> <span class="nf">resp_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;fitting of hydrogen atoms&quot;</span></div>

<div class="viewcode-block" id="FitHydrogensOnlyRespinGenerator.get_ivary"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.FitHydrogensOnlyRespinGenerator.get_ivary">[docs]</a>    <span class="k">def</span> <span class="nf">get_ivary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">([</span>
            <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">atomic_number</span> <span class="o">!=</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">ivary</span>
            <span class="k">for</span> <span class="n">atom</span><span class="p">,</span> <span class="n">ivary</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span>
                <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="o">.</span><span class="n">from_equivalence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalence</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="p">)</span>
        <span class="p">])</span></div>

<div class="viewcode-block" id="FitHydrogensOnlyRespinGenerator.get_cntrl"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.FitHydrogensOnlyRespinGenerator.get_cntrl">[docs]</a>    <span class="k">def</span> <span class="nf">get_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">(</span>
            <span class="n">iqopt</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">ihfree</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Not just hydrogens...</span>
            <span class="n">qwt</span><span class="o">=</span><span class="mf">0.0</span>  <span class="c1"># ...because there are no restraints.</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="EquivalenceOnlyRespinGenerator"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.EquivalenceOnlyRespinGenerator">[docs]</a><span class="k">class</span> <span class="nc">EquivalenceOnlyRespinGenerator</span><span class="p">(</span><span class="n">RespinGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Supports creation of &quot;respin&quot; files with no constraints beyond equivalence</span>

<span class="sd">    The generated &quot;respin&quot; file instructs ``resp`` to perform fitting in which</span>
<span class="sd">    atoms are free to vary, subject only to equivalence relations.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    equivalence : Equivalence</span>
<span class="sd">        The equivalence relations between atoms of the molecule.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">equivalence</span><span class="p">:</span> <span class="n">Equivalence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">equivalence</span> <span class="o">=</span> <span class="n">equivalence</span>

<div class="viewcode-block" id="EquivalenceOnlyRespinGenerator.resp_type"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.EquivalenceOnlyRespinGenerator.resp_type">[docs]</a>    <span class="k">def</span> <span class="nf">resp_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;atom equivalencing&quot;</span></div>

<div class="viewcode-block" id="EquivalenceOnlyRespinGenerator.get_ivary"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.EquivalenceOnlyRespinGenerator.get_ivary">[docs]</a>    <span class="k">def</span> <span class="nf">get_ivary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="o">.</span><span class="n">from_equivalence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalence</span><span class="p">)</span></div>

<div class="viewcode-block" id="EquivalenceOnlyRespinGenerator.get_cntrl"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.EquivalenceOnlyRespinGenerator.get_cntrl">[docs]</a>    <span class="k">def</span> <span class="nf">get_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">(</span>
            <span class="n">ihfree</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Not just hydrogens...</span>
            <span class="n">qwt</span><span class="o">=</span><span class="mf">0.0</span>  <span class="c1"># ...because there are no restraints.</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="FrozenAtomsRespinGenerator"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.FrozenAtomsRespinGenerator">[docs]</a><span class="k">class</span> <span class="nc">FrozenAtomsRespinGenerator</span><span class="p">(</span><span class="n">RespinGenerator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Supports creation of &quot;respin&quot; files excluding selected atoms from fitting</span>

<span class="sd">    The generated &quot;respin&quot; file instructs ``resp`` to perform fitting in which</span>
<span class="sd">    atoms are free to vary (subject to equivalence relations) unless they are</span>
<span class="sd">    explicitly excluded from the fitting by being listed in the `frozen_atoms`</span>
<span class="sd">    argument.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    equivalence : Equivalence</span>
<span class="sd">        The equivalence relations between atoms of the molecule.</span>
<span class="sd">    frozen_atoms : typing.List[int]</span>
<span class="sd">        List of zero-based indices of atoms in the molecule which are to be</span>
<span class="sd">        excluded from the fitting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">equivalence</span><span class="p">:</span> <span class="n">Equivalence</span><span class="p">,</span> <span class="n">frozen_atoms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">for</span> <span class="n">atom_label</span> <span class="ow">in</span> <span class="n">frozen_atoms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">atom_label</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">atom_label</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">equivalence</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Label of atom to be frozen (</span><span class="si">{</span><span class="n">atom_label</span><span class="si">}</span><span class="s2">) is outside of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;expected range i.e. [0, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">equivalence</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="si">}</span><span class="s2">).&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">equivalence</span> <span class="o">=</span> <span class="n">equivalence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frozen_atoms</span> <span class="o">=</span> <span class="n">frozen_atoms</span>

<div class="viewcode-block" id="FrozenAtomsRespinGenerator.resp_type"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.FrozenAtomsRespinGenerator.resp_type">[docs]</a>    <span class="k">def</span> <span class="nf">resp_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;fitting with selected atom charges frozen&quot;</span></div>

<div class="viewcode-block" id="FrozenAtomsRespinGenerator.get_ivary"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.FrozenAtomsRespinGenerator.get_ivary">[docs]</a>    <span class="k">def</span> <span class="nf">get_ivary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="p">([</span>
            <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">frozen_atoms</span> <span class="k">else</span> <span class="n">ivary</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ivary</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">Respin</span><span class="o">.</span><span class="n">Ivary</span><span class="o">.</span><span class="n">from_equivalence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">equivalence</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="p">)</span>
        <span class="p">])</span></div>

<div class="viewcode-block" id="FrozenAtomsRespinGenerator.get_cntrl"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.FrozenAtomsRespinGenerator.get_cntrl">[docs]</a>    <span class="k">def</span> <span class="nf">get_cntrl</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Respin</span><span class="o">.</span><span class="n">Cntrl</span><span class="p">(</span>
            <span class="n">iqopt</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">ihfree</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># Not just hydrogens...</span>
            <span class="n">qwt</span><span class="o">=</span><span class="mf">0.0</span>  <span class="c1"># ...because there are no restraints.</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="prepare_respin"><a class="viewcode-back" href="../../repESP.respin_generation.html#repESP.respin_generation.prepare_respin">[docs]</a><span class="k">def</span> <span class="nf">prepare_respin</span><span class="p">(</span>
    <span class="n">respin_generator</span><span class="p">:</span> <span class="n">RespinGenerator</span><span class="p">,</span>
    <span class="n">total_charge</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">molecule</span><span class="p">:</span> <span class="n">Molecule</span><span class="p">[</span><span class="n">Atom</span><span class="p">],</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">subtitle</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">read_charges</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Respin</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create ``resp`` program instructions based on input options</span>

<span class="sd">    This function allows to create ``resp`` program instructions from higher-level</span>
<span class="sd">    abstractions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    respin_generator : RespinGenerator</span>
<span class="sd">        An object implementing the `RespinGenerator` interface.</span>
<span class="sd">        This object expresses a given type of charge fitting through</span>
<span class="sd">        instructions understood by ``resp``. Implementations of this interface</span>
<span class="sd">        for common fitting types are provided in this module.</span>
<span class="sd">    total_charge : int</span>
<span class="sd">        The total charge of the molecule.</span>
<span class="sd">    molecule : Molecule[Atom]</span>
<span class="sd">        The molecule which charges are being fitted. Only atom identities are required.</span>
<span class="sd">    title : Optional[str], optional</span>
<span class="sd">        The title for the optimization. If set to None (default), a default</span>
<span class="sd">        title will be used, referencing the `repESP` library and the type of</span>
<span class="sd">        the fitting as given by the `respin_generator` used.</span>
<span class="sd">    subtitle : Optional[str], optional</span>
<span class="sd">        The subttitle for the fitted structure. If set to None (default), a</span>
<span class="sd">        default generic subtitle will be used.</span>
<span class="sd">    read_charges : bool, optional</span>
<span class="sd">        If this option is set to True, ``resp`` will require initial charges</span>
<span class="sd">        for the fitting. Defaults to False.</span>

<span class="sd">        .. note::</span>
<span class="sd">            It is the responsibility of the `respin_generator` to instruct</span>
<span class="sd">            ``resp`` to read initial charges when they affect the result of the</span>
<span class="sd">            optimization. This parameter should only be used when the user</span>
<span class="sd">            wishes to aid the optimization by supplying an initial guess.</span>

<span class="sd">        .. It could also be used in case the ``resp`` algorithm converges to</span>
<span class="sd">            different charges depending on the initial charges but I am not</span>
<span class="sd">            aware of such an issue with the ``resp`` algorithm).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Respin</span>
<span class="sd">        An object representing the fitting instructions for the ``resp`` program.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">cntrl</span> <span class="o">=</span> <span class="n">respin_generator</span><span class="o">.</span><span class="n">get_cntrl</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">read_charges</span><span class="p">:</span>
        <span class="n">cntrl</span><span class="o">.</span><span class="n">iqopt</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">default_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Respin file prepared by `repESP` to perform </span><span class="si">{</span><span class="n">respin_generator</span><span class="o">.</span><span class="n">resp_type</span><span class="p">()</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="n">default_subtitle</span> <span class="o">=</span> <span class="s2">&quot;Resp charges for organic molecule&quot;</span>

    <span class="k">return</span> <span class="n">Respin</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">default_title</span><span class="p">,</span>
        <span class="n">cntrl</span><span class="o">=</span><span class="n">cntrl</span><span class="p">,</span>
        <span class="n">subtitle</span><span class="o">=</span><span class="n">subtitle</span> <span class="k">if</span> <span class="n">subtitle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">default_subtitle</span><span class="p">,</span>
        <span class="n">charge</span><span class="o">=</span><span class="n">total_charge</span><span class="p">,</span>
        <span class="n">molecule</span><span class="o">=</span><span class="n">molecule</span><span class="p">,</span>
        <span class="n">ivary</span><span class="o">=</span><span class="n">respin_generator</span><span class="o">.</span><span class="n">get_ivary</span><span class="p">()</span>
    <span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Jan Szopinski

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>